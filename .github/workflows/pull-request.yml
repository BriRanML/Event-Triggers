name: Pull Request

on:
  pull_request:
    types: [opened, synchronize, reopened, labeled]
    branches: 
      - master

jobs:
  job1:
    name: Build
    runs-on: ubuntu-latest
    steps:
      - name: view the github context
        shell: bash
        run: |
          echo "GITHUB_WORKSPACE = $GITHUB_WORKSPACE"
          echo "github.workspace = ${{ github.workspace }}"
          echo "$GITHUB_CONTEXT"
        env:
          GITHUB_CONTEXT: ${{ toJson(github) }}

      - name: Checkout
        uses: actions/checkout@v2.3.2

  job2:
    needs: [job1]
    if: ${{ github.event.action == 'labeled' && contains(github.event.pull_request.labels.*.name, 'automerge') }}
    name: Automatically merge PR
    runs-on: ubuntu-latest
    steps:
      - name: auto-merge PR
        uses: juliangruber/merge-pull-request-action@v1.0.0
        env:
          GITHUB_TOKEN: ${{ secrets.MY_GITHUB_PAT }}
